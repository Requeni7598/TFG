library(readxl) #Libreria para trabajar con documentos EXCEL
Notas <- read_excel("Notas.xlsx") #Archivo principal
Notas = Notas[Notas$NotaPAU!=0,]
#Eliminamos todas las observaciones con NotaPAU = 0. Se trata de datos faltantes
attach(Notas)
library(sp)

#DEFINIMOS LAS COORDENADAS DE LOS INSTITUTOS DE NUESTRA MUESTRA
EDUCACIO_DISTANCIA <- cbind(-0.411,39.465) #VALENCIA
PRIVAT_MAS_CAMARENA <- cbind(-0.463,39.549) #PATERNA
SAN_JAIME_APOSTOL <- cbind(-0.393,39.545) #MONCADA
ALFINACH <- cbind(-0.330,39.624) #PUZOL
AUSIAS_MARCH <- cbind(-0.484,39.367) #PICASSENT
CUMBRES_SCHOOL <- cbind(-0.403,39.549) #MONCADA
FOMENTO_VILAVELLA <- cbind(-0.392,39.479) #VALENCIA
EL_PRAT <- cbind(-0.584,39.641) #LLIRIA
ESCUELAS_PIAS <- cbind(-0.382,39.474) #VALENCIA
FRANCISCO_LLOPIS <- cbind(-0.596,39.629) #LLIRIA
GENZANA <- cbind(-0.428,39.530) #GODELLA
GRAN_ASOCIACION <- cbind(-0.378,39.480) #VALENCIA
GUADALAVIAR <- cbind(-0.355,39.476) #VALENCIA
HELIOS <- cbind(-0.506,39.559) #ELIANA
EL_ARMELAR <- cbind(-0.429,39.508) #PATERNA
IALE <- cbind(-0.545,39.565) #ELIANA
JUAN_XXIII <- cbind(-0.417,39.517) #BURJASSOT
LA_ANUNCIACION <- cbind(-0.345,39.464) #VALENCIA
LA_CONCEPCION <- cbind(-0.607,38.828) #ONTINYENT
LA_DEVESA <- cbind(-0.532,39.229) #CARLET
LA_ENCARNACION <- cbind(-0.310,39.202) #SUECA
LA_SALLE <- cbind(-0.432,39.496) #PATERNA
LUIS_AMIGO <- cbind(-0.419,39.530) #GODELLA
MADRE_JOSEFA_CAMPOS <- cbind(-0.455,39.458) #ALAQUAAS
MARIA_AUXILIADORA <- cbind(-0.370,39.453) #VALENCIA
SENYORA_SOCORRO <- cbind(-0.398,39.424) #BENETUSSER
SENYORA_LORETO <- cbind(-0.362,39.464) #VALENCIA
PALMA <- cbind(-0.474,39.533) #CANYADA-PATERNA
PARROQUIA_BARTOLOME <- cbind(-0.410,39.519) #GODELLA
PARROQUIAL_JOSE_LLUCH <- cbind(-0.354,39.500) #ALBORAYA
PIO_XII <- cbind(-0.371,39.481) #VALENCIA
PUREZA_MARIA <- cbind(-0.409,39.470) #VALENCIA
PUREZA_HOMOLOGADO <- cbind(-0.626,38.820) #ONTINYENT
RIVAS_LUNA <- cbind(-0.543,39.563) #ELIANA
JOSE_CALASANZ <- cbind(-0.364,39.476) #VALENCIA
JOSE_MONTANYA <- cbind(-0.108,38.924) #OLIVA
SAN_ROQUE <- cbind(-0.391,39.491) #VALENCIA
VICENTE_FERRER_DOMINICOS <- cbind(-0.370,39.468) #VALENCIA
SAGRADO_CORAZON1 <- cbind(-0.408,39.517) #GODELLA
SAGRADO_CORAZON2 <- cbind(-0.418,39.475) #MISLATA
SAN_ANTONIO_ABAD <- cbind(-0.374,39.492) #VALENCIA
SAN_PABLO_CEU <- cbind(-0.389,39.550) #MONCADA
SANTA_ANA <- cbind(-0.354,39.468) #VALENCIA
SANTA_MARIA <- cbind(-0.303,39.587) #EL PUIG
SANTISIMA_TRINIDAD <- cbind(-0.377,39.483) #VALENCIA
SAGRADO_CORAZON_ESCLAVAS <- cbind(-0.366,39.476) #VALENCIA
SAGRADO_CORAZON_MARISTAS <- cbind(-0.363,39.465) #VALENCIA
TOMAS_AQUINO <- cbind(-0.467,39.532) #MONTECAÑADA-PATERNA
TOMAS_VILLANUEVA <- cbind(-0.383,39.465) #VALENCIA
PREUNIVERSITARIO_MAS_CAMARENA <- cbind(-0.463,39.550) #PATERNA
EDELWEISS <- cbind(-0.431,39.533) #CAMPO OLIVAR
ARTESANOS <- cbind(-0.369,39.463) #VALENCIA
FLORIDA_SECUNDARIA <- cbind(-0.412,39.403) #CATARROJA
FUNDACIO_ESCOLAPIES <- cbind(-0.386,39.471) #VALENCIA
IES_ABRIL <- cbind(-0.396,39.418) #ALFAFAR
IES_OCTUBRE <- cbind(-0.536,39.228) #CARLET
IES_ALAMEDA <- cbind(-1.212,39.568) #UTIEL
IES_ALBAL <- cbind(-0.409,39.399) #ALBAL
IES_ALCASSER <- cbind(-0.440,39.369) #ALCASSER
IES_CARME <- cbind(-0.381,39.480) #VALENCIA
IES_BENAGUASIL <- cbind(-0.588,39.600) #BENAGUASIL
IES_BENICALAP <- cbind(-0.400,39.496) #VALENCIA
IES_BENIMAMET <- cbind(-0.424,39.504) #BENIMAMET
IES_BERENGUER_DALMAU <- cbind(-0.404,39.409) #CATARROJA
IES_BLASCO_IBANYEZ <- cbind(-0.246,39.168) #CULLERA
IES_BOCAIRENT <- cbind(-0.613,38.765) #BOCAIRENT
IES_CAMP_TURIA <- cbind(-0.596,39.632) #LLIRIA
IES_CAMPANAR <- cbind(-0.399,39.481) #VALENCIA
IES_CARCER <- cbind(-0.565,39.072) #CARCER
IES_CLARA_CAMPOAMOR <- cbind(-0.456,39.453) #ALAQUAS
IES_COMARCAL <- cbind(-0.414,39.517) #BURJASSOT
IES_CONSUELO_ARANDA <- cbind(-0.522,39.124) #ALBERIC
IES_ADEMUZ <- cbind(-1.285,40.060) #ADEMUZ
IES_ALMUSSAFES <- cbind(-0.414,39.306) #ALMUSSAFES
IES_FAUSTI_BARBERA <- cbind(-0.462,39.452) #ALAQUAS
IES_PESET_ALEIXANDRE <- cbind(-0.452,39.509) #PATERNA
IES_EDUARDO_PRIMO <- cbind(-0.520,39.221) #CARLET
IES_CLOT <- cbind(-0.380,39.489) #VALENCIA
IES_GRAO <- cbind(-0.332,39.462) #VALENCIA
IES_ELPUIG <- cbind(-0.308,39.593) #EL PUIG
IES_ELSALER <- cbind(-0.332,39.382) #EL SALER
IES_ELS_EVOLS <- cbind(-0.501,39.196) #L'ALCUDIA
IES_ENRIC_SOLER <- cbind(-0.425,39.292) #BENIFAIO
IES_ENRIC_VALOR <- cbind(-0.413,39.356) #SILLA
IES_ENTIQUE_TIERNO_GALVAN <- cbind(-0.393,39.540) #MONCADA
IES_FEDERICA_MONTSENY <- cbind(-0.422,39.511) #BURJASSOT
IES_FERNANDO_III <- cbind(-1.054,39.055) #AYORA
IES_GABRIEL_CISCAR <- cbind(-0.112,38.912) #OLIVA
IES_GREGORI_MAIANS <- cbind(-0.115,38.923) #OLIVA
IES_GUADASSUAR <- cbind(-0.482,39.189) #CARLET
IES_GUILLEM_ALCALA <- cbind(-0.329,39.581) #POBLA FARNALS
IES_HENRI_MATISSE <- cbind(-0.449,39.510) #PATERNA
IES_HORT_FELIU <- cbind(-0.463,39.267) #ALGINET
IES_ISABEL_VILLENA <- cbind(-0.325,39.478) #VALENCIA
IES_JALANCE <- cbind(-1.071,39.192) #JALANCE
IES_JAUMEI <- cbind(-0.598,38.822) #ONTINYENT
IES_JAUMEII <- cbind(-0.259,39.077) #TAVERNES VALLDIGNA
IES_JOAN_FUSTER <- cbind(-0.303,39.206) #SUECA
IES_JOSE_SEGRELLES <- cbind(-0.524,38.836) #ALBAIDA
IES_ELIANA <- cbind(-0.527,39.571) #ELIANA
IES_ESTACIO <- cbind(-0.605,38.810) #ONTINYENT
IES_OM <- cbind(-0.456,39.364) #PICASSENT
IES_CANYADA <- cbind(-0.478,39.521) #PATERNA
IES_LAHOYA <- cbind(-0.786,39.425) #BUNYOL
IES_LA_MORERIA <- cbind(-0.422,39.478) #MISLATA
IES_LA_PATACONA <- cbind(-0.326,39.493) #ALBORAYA
IES_LA_SERRANIA <- cbind(-0.826,39.736) #VILLAR
IES_VALLDIGNA <- cbind(-0.277,39.070) #TAVERNES VALLDIGNA
IES_LA_VEREDA <- cbind(-0.540,39.586) #POBLA VALLBONA
IES_LAURONA <- cbind(-0.590,39.634) #LLIRIA
IES_LES_ALFABEGUES <- cbind(-0.463,39.596) #BETERA
IES_LLOPIS <- cbind(-0.259,39.160) #CULLERA
IES_LLUIS_VIVES <- cbind(-0.378,39.468) #VALENCIA
IES_MANUEL_SANCHIS_GUARNER <- cbind(-0.413,39.365) #SILLA
IES_MARIA_CARBONELL_I_SANCHEZ <- cbind(-0.401,39.420) #BENETUSSER
IES_BENLLIURE <- cbind(-0.369,39.483) #VALENCIA
IES_MASSAMAGRELL <- cbind(-0.339,39.574) #MASSAMAGRELL
IES_MASSANASSA <- cbind(-0.396,39.412) #MASSANASSA
IES_MESTRE_RAMON_ESTEVE <- cbind(-0.568,39.278) #CATADAU
IES_MIGUEL_BALLESTEROS <- cbind(-1.209,39.573) #UTIEL
IES_MOLI_SOL <- cbind(-0.417,39.481) #MISLATA
IES_MUSIC_MARTI <- cbind(-0.423,39.480) #MISLATA
IES_REQUENA <- cbind(-1.108,39.488) #REQUENA
IES_OLEANA <- cbind(-1.095,39.492) #REQUENA
IES_ORRIOLS <- cbind(-0.367,39.496) #VALENCIA
IES_POU_CLAR <- cbind(-0.614,38.826) #ONTINYENY
IES_PUZOL <- cbind(-0.315,39.615) #PUZOL
IES_RAFELBUNYOL <- cbind(-0.332,39.585) #RAFELBUNYOL
IES_RASCANYA <- cbind(-0.361,39.494) #VALENCIA
IES_SAN_ANTONIO <- cbind(-0.502,39.563) #SAN ANTONIO BENAGEBER
IES_VICENTE_FERRER <- cbind(-0.368,39.465) #VALENCIA
IES_SANCHIS_GUARNER <- cbind(-0.383,38.871) #CASTELLO RUGAT
IES_SEDAVI <- cbind(-0.382,39.427) #SEDAVI
IES_SERPIS <- cbind(-0.338,39.473) #VALENCIA
IES_SORROLLA <- cbind(-0.338,39.467) #VALENCIA
IES_TAVERNES_BLANQUES <- cbind(-0.369,39.507) #TAVERNES BLANQUES
IES_TURIS <- cbind(-0.708,39.393) #TURIS
IES_VERMELLAR <- cbind(-0.549,38.909) #OLLERIA
IES_VICENT_ANDRES_ESTELLES <- cbind(-0.421,39.511) #BURJASSOT
IES_VICENTA_FERRER <- cbind(-0.396,39.461) #VALENCIA
IES_VICENTE_GANDIA <- cbind(-0.511,39.073) #VILLANUEVA
IES_VILAMARXANT <- cbind(-0.623,39.572) #VILAMARXANT
DOMUS <- cbind(-0.416,39.523) #GODELLA

#CREAMOS UN VECTOR CON TODAS LAS COORDENADAS ALMACENADAS
Institutos1 <- rbind(EDUCACIO_DISTANCIA,PRIVAT_MAS_CAMARENA,SAN_JAIME_APOSTOL,ALFINACH,AUSIAS_MARCH,CUMBRES_SCHOOL,
                     FOMENTO_VILAVELLA,EL_PRAT,ESCUELAS_PIAS,FRANCISCO_LLOPIS,GENZANA,GRAN_ASOCIACION,GUADALAVIAR,HELIOS,
                     EL_ARMELAR,IALE,JUAN_XXIII,LA_ANUNCIACION,LA_CONCEPCION,LA_DEVESA,LA_ENCARNACION,LA_SALLE,LUIS_AMIGO,
                     MADRE_JOSEFA_CAMPOS,MARIA_AUXILIADORA,SENYORA_SOCORRO,SENYORA_LORETO,PALMA,PARROQUIA_BARTOLOME,
                     PARROQUIAL_JOSE_LLUCH,PIO_XII,PUREZA_MARIA,PUREZA_HOMOLOGADO,RIVAS_LUNA,JOSE_CALASANZ,JOSE_MONTANYA,
                     SAN_ROQUE,VICENTE_FERRER_DOMINICOS,SAGRADO_CORAZON1,SAGRADO_CORAZON2,SAN_ANTONIO_ABAD,SAN_PABLO_CEU,
                     SANTA_ANA,SANTA_MARIA,SANTISIMA_TRINIDAD,SAGRADO_CORAZON_ESCLAVAS,SAGRADO_CORAZON_MARISTAS,
                     TOMAS_AQUINO,TOMAS_VILLANUEVA,PREUNIVERSITARIO_MAS_CAMARENA,EDELWEISS,ARTESANOS,FLORIDA_SECUNDARIA,
                     FUNDACIO_ESCOLAPIES,IES_ABRIL,IES_OCTUBRE,IES_ALAMEDA,IES_ALBAL,IES_ALCASSER,IES_CARME,
                     IES_BENAGUASIL,IES_BENICALAP,IES_BENIMAMET,IES_BERENGUER_DALMAU,IES_BLASCO_IBANYEZ,IES_BOCAIRENT,
                     IES_CAMP_TURIA,IES_CAMPANAR,IES_CARCER,IES_CLARA_CAMPOAMOR,IES_COMARCAL,IES_CONSUELO_ARANDA,
                     IES_ADEMUZ,IES_ALMUSSAFES,IES_FAUSTI_BARBERA,IES_PESET_ALEIXANDRE,IES_EDUARDO_PRIMO,IES_CLOT,
                     IES_GRAO,IES_ELPUIG,IES_ELSALER,IES_ELS_EVOLS,IES_ENRIC_SOLER,IES_ENRIC_VALOR,IES_ENTIQUE_TIERNO_GALVAN,
                     IES_FEDERICA_MONTSENY,IES_FERNANDO_III,IES_GABRIEL_CISCAR,IES_GREGORI_MAIANS,IES_GUADASSUAR,
                     IES_GUILLEM_ALCALA,IES_HENRI_MATISSE,IES_HORT_FELIU,IES_ISABEL_VILLENA,IES_JALANCE,IES_JAUMEI,
                     IES_JAUMEII,IES_JOAN_FUSTER,IES_JOSE_SEGRELLES,IES_ELIANA,IES_ESTACIO,IES_OM,IES_CANYADA,
                     IES_LAHOYA,IES_LA_MORERIA,IES_LA_PATACONA,IES_LA_SERRANIA,IES_VALLDIGNA,IES_LA_VEREDA,
                     IES_LAURONA,IES_LES_ALFABEGUES,IES_LLOPIS,IES_LLUIS_VIVES,IES_MANUEL_SANCHIS_GUARNER,
                     IES_MARIA_CARBONELL_I_SANCHEZ,IES_BENLLIURE,IES_MASSAMAGRELL,IES_MASSANASSA,IES_MESTRE_RAMON_ESTEVE,
                     IES_MIGUEL_BALLESTEROS,IES_MOLI_SOL,IES_MUSIC_MARTI,IES_REQUENA,IES_OLEANA,IES_ORRIOLS,
                     IES_POU_CLAR,IES_PUZOL,IES_RAFELBUNYOL,IES_RASCANYA,IES_SAN_ANTONIO,IES_VICENTE_FERRER,IES_SANCHIS_GUARNER,
                     IES_SEDAVI,IES_SERPIS,IES_SORROLLA,IES_TAVERNES_BLANQUES,IES_TURIS,IES_VERMELLAR,
                     IES_VICENT_ANDRES_ESTELLES,IES_VICENTA_FERRER,IES_VICENTE_GANDIA,IES_VILAMARXANT,DOMUS)

#EMPEZAMOS A CONSTRUIR LA INFO(DATA) DE NUESTRO SPATIAL POINT

#INFORMACION GENERAL
data1G <- as.data.frame(rbind("CENTRE ESPECÍFIC D'EDUCACIÓ A DISTÀNCIA","CENTRE PRIVAT MAS CAMARENA","CENTRO SAN JAIME APOSTOL","COLG. ALFINACH S.L.",
                              "COLG. AUSIAS MARCH","COLG. CUMBRES SCHOOL","COLG. DE FOMENTO  VILAVELLA","COLG. EL PRAT","COLG. ESCUELAS PIAS",
                              "COLG. FRANCISCO LLOPIS LATORRE","COLG. GENÇANA","COLG. GRAN ASOCIACION","COLG. GUADALAVIAR","COLG. HELIOS",
                              "COLG. HOMOLOGADO EL ARMELAR","COLG. IALE, S.A.","COLG. JUAN XXIII","COLG. LA ANUNCIACION","COLG. LA CONCEPCION",
                              "COLG. LA DEVESA","COLG. LA ENCARNACION","COLG. LA SALLE","COLG. LUIS AMIGO","COLG. MADRE JOSEFA CAMPOS","COLG. MARIA AUXILIADORA",
                              "COLG. NTRA. SRA. SOCORRO","COLG. NUESTRA SRA. DE LORETO","COLG. PALMA","COLG. PARROQUIA SAN BARTOLOME","COLG. PARROQUIAL D. JOSE LLUCH",
                              "COLG. PIO XII","COLG. PUREZA DE MARIA","COLG. PUREZA DE MARIA HOMOLOGADO","COLG. RIVAS LUNA","COLG. S. JOSE DE CALASANZ",
                              "COLG. S. JOSE DE LA MONTAÑA C.V.","COLG. S. ROQUE","COLG. S. VTE. FERRER- DOMINICOS","COLG. SAGRADO  CORAZON",
                              "COLG. SAGRADO CORAZON","COLG. SAN ANTONIO ABAD","COLG. SAN PABLO - C.E.U.","COLG. SANTA ANA","COLG. SANTA MARIA DE EL PUIG",
                              "COLG. SANTISIMA TRINIDAD","COLG. SGDO. CORAZON JESUS-ESCLAVAS","COLG. SGDO. CORAZON. HH.MARISTAS","COLG. STO. TOMAS DE AQUINO",
                              "COLG. STO. TOMAS VILLANUEVA","COMPLEJO PREUNIVERSITARIO MAS CAMARENA","EDELWEISS SCHOOL","ESCUELAS PROFESIONALES DE ARTESANOS",
                              "FLORIDA, SECUNDARIA","FUNDACIÓ ESCOLAPIES","I.E.S. 25 DE ABRIL","I.E.S. 9 D'OCTUBRE","I.E.S. ALAMEDA","I.E.S. ALBAL",
                              "I.E.S. ALCASSER","I.E.S. BARRI DEL CARME","I.E.S. BENAGUASIL","I.E.S. BENICALAP","I.E.S. BENIMAMET","I.E.S. BERENGUER DALMAU",
                              "I.E.S. BLASCO IBAÑEZ","I.E.S. BOCAIRENT","I.E.S. CAMP DE TURIA","I.E.S. CAMPANAR","I.E.S. CARCER","I.E.S. CLARA CAMPOAMOR",
                              "I.E.S. COMARCAL","I.E.S. CONSUELO ARANDA","I.E.S. DE ADEMUZ","I.E.S. DE ALMUSSAFES","I.E.S. DR. FAUSTI BARBERA",
                              "I.E.S. DR. PESET ALEIXANDRE","I.E.S. EDUARDO PRIMO MARQUÉS","I.E.S. EL CLOT","I.E.S. EL GRAO","I.E.S. EL PUIG","I.E.S. EL SALER",
                              "I.E.S. ELS EVOLS","I.E.S. ENRIC SOLER I GODES","I.E.S. ENRIC VALOR","I.E.S. ENRIQUE  TIERNO GALVAN","I.E.S. FEDERICA MONTSENY",
                              "I.E.S. FERNANDO III","I.E.S. GABRIEL CISCAR","I.E.S. GREGORI MAIANS","I.E.S. GUADASSUAR","I.E.S. GUILLEM D'ALCALÀ",
                              "I.E.S. HENRI MATISSE","I.E.S. HORT DE FELIU","I.E.S. ISABEL DE VILLENA","I.E.S. JALANCE","I.E.S. JAUME I","I.E.S. JAUME II EL JUST",
                              "I.E.S. JOAN FUSTER","I.E.S. JOSE SEGRELLES","I.E.S. L'ELIANA","I.E.S. L'ESTACIO","I.E.S. L'OM","I.E.S. LA CANYADA",
                              "I.E.S. LA HOYA DE BUÑOL","I.E.S. LA MORERIA","I.E.S. LA PATACONA","I.E.S. LA SERRANIA","I.E.S. LA VALLDIGNA","I.E.S. LA VEREDA",
                              "I.E.S. LAURONA","I.E.S. LES ALFABEGUES","I.E.S. LLOPIS MARI DE CULLERA","I.E.S. LLUIS VIVES","I.E.S. MANUEL SANCHIS GUARNER",
                              "I.E.S. MARIA CARBONELL I SANCHEZ","I.E.S. MARIANO BENLLIURE","I.E.S. MASSAMAGRELL","I.E.S. MASSANASSA","I.E.S. MESTRE RAMON ESTEVE",
                              "I.E.S. MIGUEL BALLESTEROS VIANA","I.E.S. MOLI DEL SOL","I.E.S. MÚSIC MARTI I SOLER","I.E.S. Nº 1 DE REQUENA","I.E.S. OLEANA",
                              "I.E.S. ORRIOLS","I.E.S. POU CLAR","I.E.S. PUÇOL","I.E.S. RAFELBUNYOL","I.E.S. RASCANYA-ANTONIO CAÑUELO","I.E.S. SAN ANTONIO DE BENAGÉBER",
                              "I.E.S. SAN VICENTE FERRER","I.E.S. SANCHIS GUARNER","I.E.S. SEDAVI","I.E.S. SERPIS","I.E.S. SOROLLA","I.E.S. TAVERNES BLANQUES",
                              "I.E.S. TURIS","I.E.S. VERMELLAR","I.E.S. VICENT ANDRES ESTELLES","I.E.S. VICENTA FERRER ESCRIVA","I.E.S. VICENTE GANDIA",
                              "I.E.S. VILAMARXANT","INSTITUCION CULTURAL DOMUS"))
colnames(data1G)=c("Instituto") #NOMBRE INSTITUTOS


data2G <- c()
for (i in 1:(length(unique(Notas$Centro))-1)){ #RECORDAMOS QUE EL CENTRO TRASLADOS NO NOS INTERESA
  data2G <- as.data.frame(cbind(data2G,table(Notas$Centro)[i]))
}
data2G <- as.data.frame(t(data2G))
colnames(data2G)=c("Estudiantes") #ESTUDIANTES POR INSTITUTO

info3G = aggregate(Notas$NotaPAU, list(Notas$Centro), mean) #NOTA MEDIA POR INSTITUTO
data3G <- c()
for (i in 1:(length(unique(Notas$Centro))-1)){
  data3G <- as.data.frame(cbind(data3G,info3G$x[i]))
}
data3G <- as.data.frame(t(data3G))
colnames(data3G)=c("NotaMedia")

info4G = aggregate(Notas$NotaPAU, list(Notas$Centro,Notas$Sexo), mean) #NOTA MEDIA POR INSTITUTO Y SEXO
info4G = info4G[info4G$Group.2=="H",] 
#EN FOMENTO VILAVELLA Y GUADALAVIAR NO ESTUDIAN HOMBRES. DEBEMOS INDICARLO
infoextra = as.data.frame(matrix(c("COLG. DE FOMENTO  VILAVELLA","H","NA","COLG. GUADALAVIAR","H","NA"),nrow=2,byrow=T))
colnames(infoextra)=c("Group.1","Group.2","x")
info4G=rbind(info4G[1:6,],infoextra[1,],info4G[7:11,],infoextra[2,],info4G[12:142,]) #YA TENEMOS TODOS LOS INSTITUTOS
data4G <- c()
for (i in 1:(length(unique(Notas$Centro))-1)){
  data4G <- as.data.frame(cbind(data4G,info4G$x[i]))
}
data4G <- as.data.frame(t(data4G))
colnames(data4G)=c("NotaMediaH")

info5G = aggregate(Notas$NotaPAU, list(Notas$Centro,Notas$Sexo), mean) #NOTA MEDIA POR INSTITUTO Y SEXO
info5G = info5G[info5G$Group.2=="M",]
data5G <- c()
for (i in 1:(length(unique(Notas$Centro))-1)){
  data5G <- as.data.frame(cbind(data5G,info5G$x[i]))
}
data5G <- as.data.frame(t(data5G))
colnames(data5G)=c("NotaMediaM")

data = cbind(data1G,data2G,data3G,data4G,data5G) #DATA CON LAS CINCO COLUMNAS
pointsGI <- SpatialPointsDataFrame(coords = Institutos1, data=data) #SPATIAL POINT

save(pointsGI,file="/Users/requelui/Desktop/UNIVERSIDAD/TFG/R STUDIO/data/InstitutoG.rda")

#AHORA NOS ENFRENTAMOS AL RETO DE CONSEGUIR LA INFO POR MUNICIPIOS

CIUDADES <- c("ADEMUZ","ALAQUAS","ALBAIDA","ALBAL","ALBERIC","ALBORAYA","ALCASSER","ALFAFAR","ALGINET","ALMUSSAFES","AYORA","BENAGUASIL","BENETUSSER",
              "BENIFAIO","BENIMAMET","BETERA","BOCAIRENT","BUÑOL","BURJASSOT","CAMPOLIVAR","CARCER","CARLET","CASTELLO_DE_RUGAT","CATADAU","CATARROJA",
              "CULLERA","EL_PUIG","EL_SALER","GODELLA","GUADASSUAR","JALANCE","L'ALCUDIA","L'OLLERIA","LA_CAÑADA-PATERNA","LA_ELIANA","LA_POBLA_DE_FARNALS",
              "LA_POBLA_DE_VALLBONA","LLIRIA","MASSAMAGRELL","MASSANASSA","MISLATA","MONCADA","MONTECAÑADA-PATERNA","OLIVA","ONTINYENT","PATERNA",
              "PICASSENT","PUZOL","RAFELBUNYOL","REQUENA","S._ANTONIO_BENAGEBER","SEDAVI","SILLA","SUECA","TAVERNES_BLANQUES","TAVERNES_DE_VALLDIGNA",
              "TURÍS","UTIEL","VALENCIA","VILAMARXANT","VILLANUEVA_CASTELLON","VILLAR_DEL_ARZOBISPO")

#YA TENEMOS CASO CONCRETO. EXTRAPOLAR
for(j in 1:length(CIUDADES)){
  if (j != 59){
  CIUDADES[j]
  NotasA = Notas[Notas$Municipio==CIUDADES[j],]
  INSTITUTOSA = unique(NotasA$Centro)
  INSTITUTOSA = as.data.frame(INSTITUTOSA)
  INSTITUTOSA = na.omit(INSTITUTOSA)
  INSTITUTOSA$INSTITUTOSA = as.character(INSTITUTOSA$INSTITUTOSA)
  INSTITUTOSA = INSTITUTOSA[order(INSTITUTOSA$INSTITUTOSA),] #ORDEN ALFABETICO
  INSTITUTOSA = as.data.frame(INSTITUTOSA)
  INSTITUTOSA$INSTITUTOSA = as.character(INSTITUTOSA$INSTITUTOSA)
  COORDENADAS <- c()
  for(i in 1:dim(INSTITUTOSA)[1]){
    DATOS=which(data1G==INSTITUTOSA[i,1])
    COORDENADAS=rbind(COORDENADAS,Institutos1[DATOS,])
  }
  INSTITUTOSA = as.data.frame(INSTITUTOSA)
  colnames(INSTITUTOSA)=c("Instituto")
  data2G <- c()
  for (i in 1:dim(INSTITUTOSA)[1]){
    data2G <- as.data.frame(cbind(data2G,table(NotasA$Centro)[i]))
  }
  data2G <- as.data.frame(t(data2G))
  colnames(data2G)=c("Estudiantes") #ESTUDIANTES POR INSTITUTO
  
  info3G = aggregate(NotasA$NotaPAU, list(NotasA$Centro), mean) #NOTA MEDIA POR INSTITUTO
  data3G <- c()
  for (i in 1:dim(INSTITUTOSA)[1]){
    data3G <- as.data.frame(cbind(data3G,info3G$x[i]))
  }
  data3G <- as.data.frame(t(data3G))
  colnames(data3G)=c("NotaMedia")
  
  info4G = aggregate(NotasA$NotaPAU, list(NotasA$Centro,NotasA$Sexo), mean) #NOTA MEDIA POR INSTITUTO Y SEXO
  info4G = info4G[info4G$Group.2=="H",] 
  data4G <- c()
  for (i in 1:dim(INSTITUTOSA)[1]){
    data4G <- as.data.frame(cbind(data4G,info4G$x[i]))
  }
  data4G <- as.data.frame(t(data4G))
  colnames(data4G)=c("NotaMediaH")
  
  info5G = aggregate(NotasA$NotaPAU, list(NotasA$Centro,NotasA$Sexo), mean) #NOTA MEDIA POR INSTITUTO Y SEXO
  info5G = info5G[info5G$Group.2=="M",]
  data5G <- c()
  for (i in 1:dim(INSTITUTOSA)[1]){
    data5G <- as.data.frame(cbind(data5G,info5G$x[i]))
  }
  data5G <- as.data.frame(t(data5G))
  colnames(data5G)=c("NotaMediaM")
  
  data = cbind(INSTITUTOSA,data2G,data3G,data4G,data5G) #DATA CON LAS CINCO COLUMNAS
  pointsGI <- SpatialPointsDataFrame(coords = COORDENADAS, data=data) #SPATIAL POINT
  
  save(pointsGI,file=paste0("/Users/requelui/Desktop/UNIVERSIDAD/TFG/R STUDIO/data/Instituto",j,".rda"))
  } else{
    CIUDADES[j]
    NotasA = Notas[Notas$Municipio==CIUDADES[j],] #VAMOS A QUITAR TRASLADOS
    NotasA = NotasA[NotasA$Centro!="TRASLADOS",]
    INSTITUTOSA = unique(NotasA$Centro)
    INSTITUTOSA = as.data.frame(INSTITUTOSA)
    INSTITUTOSA = na.omit(INSTITUTOSA)
    INSTITUTOSA$INSTITUTOSA = as.character(INSTITUTOSA$INSTITUTOSA)
    INSTITUTOSA = INSTITUTOSA[order(INSTITUTOSA$INSTITUTOSA),] #ORDEN ALFABETICO
    INSTITUTOSA = as.data.frame(INSTITUTOSA)
    INSTITUTOSA$INSTITUTOSA = as.character(INSTITUTOSA$INSTITUTOSA)
    COORDENADAS <- c()
    for(i in 1:dim(INSTITUTOSA)[1]){
      DATOS=which(data1G==INSTITUTOSA[i,1])
      COORDENADAS=rbind(COORDENADAS,Institutos1[DATOS,])
    }
    INSTITUTOSA = as.data.frame(INSTITUTOSA)
    colnames(INSTITUTOSA)=c("Instituto")
    data2G <- c()
    for (i in 1:dim(INSTITUTOSA)[1]){ #RECORDAMOS QUE EL CENTRO TRASLADOS NO NOS INTERESA
      data2G <- as.data.frame(cbind(data2G,table(NotasA$Centro)[i]))
    }
    data2G <- as.data.frame(t(data2G))
    colnames(data2G)=c("Estudiantes") #ESTUDIANTES POR INSTITUTO
    
    info3G = aggregate(NotasA$NotaPAU, list(NotasA$Centro), mean) #NOTA MEDIA POR INSTITUTO
    data3G <- c()
    for (i in 1:dim(INSTITUTOSA)[1]){
      data3G <- as.data.frame(cbind(data3G,info3G$x[i]))
    }
    data3G <- as.data.frame(t(data3G))
    colnames(data3G)=c("NotaMedia")
    
    info4G = aggregate(NotasA$NotaPAU, list(NotasA$Centro,NotasA$Sexo), mean) #NOTA MEDIA POR INSTITUTO Y SEXO
    info4G = info4G[info4G$Group.2=="H",] 
    #EN FOMENTO VILAVELLA Y GUADALAVIAR NO ESTUDIAN HOMBRES. DEBEMOS INDICARLO
    infoextra = as.data.frame(matrix(c("COLG. DE FOMENTO  VILAVELLA","H","NA","COLG. GUADALAVIAR","H","NA"),nrow=2,byrow=T))
    colnames(infoextra)=c("Group.1","Group.2","x")
    info4G=rbind(info4G[1,],infoextra[1,],info4G[2:3,],infoextra[2,],info4G[4:33,]) #YA TENEMOS TODOS LOS INSTITUTOS
    data4G <- c()
    for (i in 1:dim(INSTITUTOSA)[1]){
      data4G <- as.data.frame(cbind(data4G,info4G$x[i]))
    }
    data4G <- as.data.frame(t(data4G))
    colnames(data4G)=c("NotaMediaH")
    
    info5G = aggregate(NotasA$NotaPAU, list(NotasA$Centro,NotasA$Sexo), mean) #NOTA MEDIA POR INSTITUTO Y SEXO
    info5G = info5G[info5G$Group.2=="M",]
    data5G <- c()
    for (i in 1:dim(INSTITUTOSA)[1]){
      data5G <- as.data.frame(cbind(data5G,info5G$x[i]))
    }
    data5G <- as.data.frame(t(data5G))
    colnames(data5G)=c("NotaMediaM")
    
    data = cbind(INSTITUTOSA,data2G,data3G,data4G,data5G) #DATA CON LAS CINCO COLUMNAS
    pointsGI <- SpatialPointsDataFrame(coords = COORDENADAS, data=data) #SPATIAL POINT
    
    save(pointsGI,file=paste0("/Users/requelui/Desktop/UNIVERSIDAD/TFG/R STUDIO/data/Instituto",j,".rda"))
  }
}
